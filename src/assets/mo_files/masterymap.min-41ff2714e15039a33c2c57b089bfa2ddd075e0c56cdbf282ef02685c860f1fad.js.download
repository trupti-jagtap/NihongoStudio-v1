"use strict";var $jscomp=$jscomp||{};$jscomp.scope={},$jscomp.findInternal=function(t,i,e){t instanceof String&&(t=String(t));for(var n=t.length,a=0;a<n;a++){var o=t[a];if(i.call(e,o,a,t))return{i:a,v:o}}return{i:-1,v:void 0}},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(t,i,e){t!=Array.prototype&&t!=Object.prototype&&(t[i]=e.value)},$jscomp.getGlobal=function(t){return"undefined"!=typeof window&&window===t?t:"undefined"!=typeof global&&null!=global?global:t},$jscomp.global=$jscomp.getGlobal(this),$jscomp.polyfill=function(t,i,e,n){if(i){for(e=$jscomp.global,t=t.split("."),n=0;n<t.length-1;n++){var a=t[n];a in e||(e[a]={}),e=e[a]}(i=i(n=e[t=t[t.length-1]]))!=n&&null!=i&&$jscomp.defineProperty(e,t,{configurable:!0,writable:!0,value:i})}},$jscomp.polyfill("Array.prototype.find",function(t){return t||function(t,i){return $jscomp.findInternal(this,t,i).v}},"es6","es3");var MasteryMap=function(t,i,e,n,a,o,s,r){this.mapReady=this.debug=!1,this.infoPanel=e,this.imagePanel=n,this.initialJml=a,this.clickableJml=o,this.imagePath=s,this.svg=t,this.snap=Snap("#"+t),this.shadow=this.snap.paper.filter(Snap.filter.shadow(-2,4,4)),this.snap.attr({viewBox:"0 0 518 552"}),this.counter=1,this.stopCounter=0,this.animating=!1,this.debug&&this.snap.click(function(t){this.getLatLong(t)}.bind(this)),this.locations=[],this.xfactor=29.53703704,this.xoffset=-3795.537037,this.yfactor=-35.2173913,this.yoffset=1604.869565,this.highlightColor="#9e3e79",this.locationColor="#dad8db",this.locationFontSize=10,this.locationNumbers=!0,this.arrowColor="#c88cad",this.arrowStrokeWidth=3,this.arrowOpacity=.4,this.autoAnimate=r,this.image=Snap.load(i,function(t){this.snap.append(t),this.initialize()}.bind(this))};MasteryMap.prototype.animateOnReady=function(){this.mapReady?this.animateJml(this.initialJml):document.body.addEventListener("locations_added",function(){this.animateJml(this.initialJml)}.bind(this))},MasteryMap.prototype.animateJml=function(t){this.animating=!0,1>t||70<t||(this.counter=1,this.stopCounter=t,$("#stopAnimationLink").fadeIn(),this.animateNext())},MasteryMap.prototype.clickItem=function(t){this.animating||((t=parseInt(t))<=this.clickableJml&&(this.deselectAll(),t===this.stopCounter?this.stopCounter=0:(this.stopCounter=t,this.selectItem(t))),t=new CustomEvent("location_clicked",{detail:{jml:t}}),document.body.dispatchEvent(t))},MasteryMap.prototype.initialize=function(){var t=this;mapLocations.forEach(function(i){t.addLocation(i)}),0<this.initialJml&&this.autoAnimate&&this.animateJml(this.initialJml);var i=new Event("locations_added");document.body.dispatchEvent(i),this.mapReady=!0},MasteryMap.prototype.addLocation=function(t){var i=this.getCoords(t.lat,t.long),e=this.locations.length+1,n=this.snap.paper.circle(i.x,i.y,3).attr({id:"c_"+e,fill:this.locationColor});e<=this.clickableJml&&(n.node.onclick=function(){this.clickItem(e)}.bind(this),n.attr({style:"cursor: pointer"}));var a=this.snap.paper.text(i.x,i.y+this.locationFontSize/2-3,e);a.attr({id:"t_"+e,display:"none",fill:"white","font-size":this.locationFontSize,textAnchor:"middle"}),e<=this.clickableJml&&(a.node.onclick=function(){this.clickItem(e)}.bind(this),a.attr({cursor:"pointer"})),i=this.snap.paper.group(n,a).attr({id:"g_"+e,mode:"off",x:i.x,y:i.y}),t.jml&&i.attr({jml:t.jml}),t.name_furigana&&t.name_jpn&&(i.attr({name_furigana:t.name_furigana}),i.attr({name_jpn:t.name_jpn})),t.name_eng&&i.attr({name_eng:t.name_eng}),t.category&&i.attr({kind:t.category}),t.info&&i.attr({info:t.info}),t.links&&i.attr({links:t.links}),t.image&&i.attr({image:t.image}),this.locations.push(i),$("#key").append('<div><a id="l_'+e+'" onclick="mm.clickItem(\''+e+"')\">"+e+" "+t.name_eng+"</a></div>")},MasteryMap.prototype.animateAll=function(){this.counter=1,this.stopCounter=this.locations.length,$("#stopAnimationLink").fadeIn(),this.animateNext()},MasteryMap.prototype.animateNext=function(){if(this.counter>this.stopCounter){this.animating=!1,$("#stopAnimationLink").hide();var t=new Event("animation_complete");document.body.dispatchEvent(t)}else"on"==this.getLocation(this.counter).attr("mode")?(this.counter+=1,this.animateNext()):(this.selectItem(this.counter),this.counter+=1,setTimeout(this.animateNext.bind(this),250))},MasteryMap.prototype.animateRank=function(t){0===t?(this.counter=1,this.stopCounter=9):(this.counter=10*t,this.stopCounter=this.counter+9),$("#stopAnimationLink").fadeIn(),this.animateNext()},MasteryMap.prototype.createBadgeSvg=function(t){return"<svg viewBox='0 0 20 20'><circle cx='10' cy='10' r='10' fill='#9e3e79' style='opacity: 1;'></circle><text x='10' y='10' fill='#ffffff' style='font-size: 12px; text-anchor: middle; alignment-baseline: central;'>"+t+"</text></svg>"},MasteryMap.prototype.deselectAll=function(){this.locations.forEach(function(t){if(t.attr("mode")&&"on"==t.attr("mode")){var i=parseInt(t.attr("id").substring(2));i=this.snap.select("#c_"+i);var e=new Snap.Matrix;e.scale(3,3,t.attr("x"),t.attr("y")),i.animate({transform:e},500,mina.bounce)}}.bind(this)),$("#"+this.infoPanel).html(""),$("#"+this.imagePanel).html("")},MasteryMap.prototype.displayInfo=function(t){this.infoPanel&&$.ajax({url:"/mastery/get_jml_info/"+t,type:"post"}).success(function(t){if(0===t.result){var i="";if(t=JSON.parse(t.jml_info),i+="<div style='height:60px;display:flex;align-items:center;'>",i+="<div style='flex-basis:50px;text-align:center;'>"+this.createBadgeSvg(t.jml)+"</div>",t.name_jpn){var e=t.name_jpn,n=encodeURIComponent(e);e=t.name_furigana}else n=e=t.name_eng;i+="<div style='padding-bottom:8px;padding-left:5px;font-weight:bold;font-size: 20px;line-height:inherit;'>"+e+"</div>",i+="</div>",i+="<div>Welcome to "+t.name_eng+"! ",t.info&&0<t.info.length&&(i+="<div class='halfspaced'>"+t.info+"</div>"),i+="<div class='spaced'>MORE INFO: ",t.links?t.links.split("|").forEach(function(t){i+=t+"&nbsp; "}):(i+="<a href='https://ja.wikipedia.org/wiki/"+n+"' target='_blank'>Wikipedia Japan \u21d7</a>&nbsp; ",i+="<a href='https://www.google.co.jp/search?q="+n+"' target='_blank'>Google Japan \u21d7</a>&nbsp; "),i+="<a href='https://maps.google.com?q="+t.lat+","+t.long+"' target='_blank'>Google maps \u21d7</a>",$("#"+this.infoPanel).html(i),t.image&&0<t.image.length&&this.loadImage(t.image)}}.bind(this))},MasteryMap.prototype.getId=function(t){return parseInt(t.attr("id").substring(2))},MasteryMap.prototype.getLocation=function(t){return this.locations.find(function(i){return i.attr("id")=="g_"+t})},MasteryMap.prototype.getLocationCoords=function(t){return{x:(t=this.getLocation(t)).attr("x"),y:t.attr("y")}},MasteryMap.prototype.joinPoints=function(t,i){var e=t.x,n=t.y-8;return e="M"+e+","+n+" C"+((t=i.x)>e?e+10:e-10)+","+((i=i.y-8)>n?n+10:n-10)+" ",this.snap.path(e+(t+",")+(i-10)+" "+t+","+i).attr({fill:"none",stroke:this.arrowColor,strokeWidth:this.arrowStrokeWidth,opacity:this.arrowOpacity})},MasteryMap.prototype.getCoords=function(t,i){return{x:i*this.xfactor+this.xoffset,y:t*this.yfactor+this.yoffset}},MasteryMap.prototype.getLatLong=function(t){var i=document.querySelector(this.svg).createSVGPoint();i.x=t.clientX,i.y=t.clientY,t=i.matrixTransform(document.querySelector(this.svg).getScreenCTM().inverse()),alert("Screen coords: ("+Math.round(t.x)+","+Math.round(t.y)+")\nLat: "+Math.round((t.y-this.yoffset)/this.yfactor*10)/10+"E Long: "+Math.round((t.x-this.xoffset)/this.xfactor*10)/10+"N")},MasteryMap.prototype.loadImage=function(t){if(this.imagePath){var i=new Image,e=this;$(i).load(function(){$("#"+e.imagePanel).append($(this))}).attr({src:this.imagePath+t}).error(function(){})}},MasteryMap.prototype.selectItem=function(t){var i=this.getLocation(t);if(1<t){var e=this.getLocationCoords(t-1),n=this.getLocationCoords(t);(e=this.joinPoints(e,n)).attr({id:"a_"+t}),this.locations[t-1].add(e)}(e=this.snap.select("#c_"+t)).attr({fill:this.highlightColor,opacity:1}),this.snap.append(e),n=new Snap.Matrix,this.stopCounter===t?(n.scale(5,5,i.attr("x"),i.attr("y")),e.animate({transform:n},500,mina.bounce)):n.scale(3,3,i.attr("x"),i.attr("y")),e.animate({transform:n},500,mina.bounce),(this.locationNumbers||this.stopCounter===t)&&($("#t_"+t).fadeIn(),$("#l_"+t).animate({"background-color":this.highlightColor,color:"white"},400),e=this.snap.select("#t_"+t),this.snap.append(e)),this.stopCounter===t?this.displayInfo(t):($("#"+this.infoPanel).html(""),$("#"+mm.imagePanel).html("")),i.attr({mode:"on"})},MasteryMap.prototype.resetItem=function(t){t.attr({mode:"off"}),t=parseInt(t.attr("id").substring(2));var i=this.snap.select("#c_"+t);i.attr({fill:this.highlightColor,opacity:1}),i.animate({transform:"S1"},250,mina.bounce),this.snap.select("#t_"+t).attr({display:"none"}),(i=this.snap.select("#a_"+t))&&i.remove(),$("#"+this.infoPanel).html(""),$("#"+this.imagePanel).html(""),$("#l_"+t).animate({"background-color":"#f8f8f8",color:"#4472B9"},400)},MasteryMap.prototype.stopAnimation=function(){this.counter=this.locations.length},MasteryMap.prototype.resetAll=function(){this.locations.forEach(function(t){this.resetItem(t)}.bind(this))},MasteryMap.prototype.getNewRankNames=function(){var t="";return this.locations.forEach(function(i){var e=this.getId(i);1!=e&&0!=e%10||(t+="<div>Rank "+e+": "+i.attr("name")+"</div>")}.bind(this)),t},MasteryMap.prototype.highlightKind=function(t){this.locations.forEach(function(i){i.attr("kind")===t&&this.selectItem(this.getId(i))}.bind(this))};